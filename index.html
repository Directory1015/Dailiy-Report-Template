<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Daily Site Report</title>
  <meta name="description" content="Lightweight daily construction report web app. Works on GitHub Pages. Saves to localStorage. Export to JSON or Print to PDF." />
  <style>
    :root{
      --ink:#0e1223; --bg:#0b0f1a; --card:#121826; --muted:#8ea0b5; --brand:#4f8cff; --accent:#22c55e; --warn:#ef4444; --ring:#3b82f6;
    }
    *{ box-sizing:border-box }
    html,body{ margin:0; padding:0; background:var(--bg); color:#e6e8ee; font-family:system-ui, Segoe UI, Roboto, Inter, Arial, sans-serif; }
    a{ color:#9ec5ff; text-decoration:none }
    a:hover{ text-decoration:underline }

    header{
      position:sticky; top:0; z-index:10;
      background:linear-gradient(90deg, #0b1020, #0b1b33 60%, #0b1020);
      border-bottom:1px solid rgba(255,255,255,.08);
    }
    .wrap{ max-width:1100px; margin:0 auto; padding:20px; }
    .row{ display:grid; gap:12px; grid-template-columns: repeat(auto-fit, minmax(220px,1fr)); }
    .card{ background:var(--card); border:1px solid rgba(255,255,255,.08); border-radius:14px; padding:16px; box-shadow:0 6px 24px rgba(0,0,0,.25); }
    .card h2{ margin:0 0 10px; font-size:1.05rem; letter-spacing:.3px }
    label{ font-size:.85rem; color:var(--muted); display:block; margin-bottom:6px }
    input[type="text"], input[type="number"], input[type="date"], input[type="time"], textarea, select{
      width:100%; padding:10px 12px; border-radius:10px; border:1px solid rgba(255,255,255,.12);
      background:#0e1527; color:#e6e8ee; outline:none;
    }
    textarea{ min-height:120px; resize:vertical }
    input:focus, textarea:focus, select:focus{ border-color:var(--ring); box-shadow:0 0 0 3px rgba(59,130,246,.25) }

    .toolbar{ display:flex; flex-wrap:wrap; gap:10px; align-items:center }
    .btn{
      appearance:none; border:1px solid rgba(255,255,255,.12); background:#0f1730; color:#e6e8ee;
      padding:8px 12px; border-radius:10px; cursor:pointer; font-weight:600;
    }
    .btn:hover{ border-color:#7aa2ff }
    .btn.brand{ background:var(--brand); border-color:transparent; color:#071027 }
    .btn.accent{ background:var(--accent); border-color:transparent; color:#06120a }
    .btn.warn{ background:var(--warn); border-color:transparent; color:#fff }
    .btn.ghost{ background:transparent }
    .btn.sm{ padding:6px 10px; font-size:.9rem; }

    table{ width:100%; border-collapse:separate; border-spacing:0 8px; }
    thead th{
      text-align:left; font-size:.82rem; font-weight:700; color:#b9c5d6; padding:0 8px 6px 8px;
    }
    tbody tr{
      background:#0f1526; border:1px solid rgba(255,255,255,.08);
    }
    tbody tr td{ padding:8px; }
    tbody tr td > input, tbody tr td > select, tbody tr td > textarea{
      width:100%; padding:8px 10px; background:#0c1222; border:1px solid rgba(255,255,255,.12); border-radius:8px; color:#e6e8ee;
    }
    .cell-actions{ white-space:nowrap }
    .del{ background:transparent; border:1px solid rgba(255,255,255,.15); color:#fca5a5; padding:6px 10px; border-radius:8px; cursor:pointer }
    .del:hover{ border-color:#f87171; color:#fff }

    .grid-2{ display:grid; gap:16px; grid-template-columns:1fr; }
    @media (min-width:900px){ .grid-2{ grid-template-columns:1fr 1fr } }

    .brandline{
      display:flex; align-items:center; gap:14px; padding:14px 0;
    }
    .brandline img{ width:52px; height:52px; object-fit:cover; border-radius:12px; box-shadow:0 6px 18px rgba(0,0,0,.4) }
    .brandline .title{ font-size:1.35rem; font-weight:800; letter-spacing:.3px }
    .muted{ color:var(--muted) }

    .sticky-actions{
      position:sticky; bottom:0; background:linear-gradient(0deg, rgba(11,15,26,.95), rgba(11,15,26,.6) 60%, transparent);
      padding:14px 0 18px; margin-top:30px; border-top:1px dashed rgba(255,255,255,.12);
    }
    .help{ font-size:.85rem; color:#a9b7cc }
    .hidden{ display:none !important }

    @media print{
      header, .sticky-actions{ display:none !important }
      body{ background:#fff; color:#000 }
      .card{ background:#fff; color:#000; border-color:#ddd; box-shadow:none }
      input, textarea, select{ border:1px solid #aaa; color:#000; background:#fff }
      .btn, .del{ display:none !important }
    }
  </style>
</head>
<body>
<header>
  <div class="wrap">
    <div class="brandline">
      <!-- Optional logo: put your logo file into the repo and point src here -->
      <img src="logo.png" alt="Logo" onerror="this.style.visibility='hidden'">
      <div>
        <div class="title">Daily Site Report</div>
        <div class="muted">Lightweight, offline-friendly, autosaves locally</div>
      </div>
    </div>

    <div class="row">
      <div class="card">
        <label for="projectName">Project Name</label>
        <input id="projectName" type="text" placeholder="e.g., Comet Sneads Ferry Apartments">
      </div>
      <div class="card">
        <label for="reportDate">Report Date</label>
        <input id="reportDate" type="date">
      </div>
      <div class="card">
        <label for="superintendent">Prepared By</label>
        <input id="superintendent" type="text" placeholder="Your name">
      </div>
      <div class="card">
        <label for="weather">Weather</label>
        <input id="weather" type="text" placeholder="e.g., Sunny, 84Â°F, light wind">
      </div>
    </div>
  </div>
</header>

<main class="wrap">

  <div class="grid-2">

    <!-- Manpower -->
    <section class="card">
      <h2>Manpower</h2>
      <div class="toolbar" style="margin-bottom:10px">
        <button class="btn sm brand" type="button" data-add="manpower">+ Add Row</button>
        <button class="btn sm ghost" type="button" data-clear="manpower">Clear Table</button>
      </div>
      <div class="help">Track crews on site, hours worked, and tasks performed.</div>
      <div class="table-wrap">
        <table data-table="manpower">
          <thead>
          <tr>
            <th>Company</th>
            <th>Crew / Name</th>
            <th>Hours</th>
            <th>Task</th>
            <th class="cell-actions">Actions</th>
          </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <!-- Vendors / Subcontractors -->
    <section class="card">
      <h2>Vendors / Subcontractors</h2>
      <div class="toolbar" style="margin-bottom:10px">
        <button class="btn sm brand" type="button" data-add="vendors">+ Add Vendor</button>
        <button class="btn sm ghost" type="button" data-clear="vendors">Clear Table</button>
      </div>
      <div class="help">Who worked on site today and what they handled.</div>
      <table data-table="vendors">
        <thead>
        <tr>
          <th>Vendor</th>
          <th>Contact</th>
          <th>Phone</th>
          <th>Work / Notes</th>
          <th class="cell-actions">Actions</th>
        </tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>

    <!-- Deliveries -->
    <section class="card">
      <h2>Deliveries</h2>
      <div class="toolbar" style="margin-bottom:10px">
        <button class="btn sm brand" type="button" data-add="deliveries">+ Add Delivery</button>
        <button class="btn sm ghost" type="button" data-clear="deliveries">Clear Table</button>
      </div>
      <div class="help">Record materials received and time of delivery.</div>
      <table data-table="deliveries">
        <thead>
        <tr>
          <th>Vendor</th>
          <th>Item</th>
          <th>Qty</th>
          <th>Unit</th>
          <th>Time</th>
          <th>Received</th>
          <th>Notes</th>
          <th class="cell-actions">Actions</th>
        </tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>

    <!-- Items / Equipment / Materials -->
    <section class="card">
      <h2>Items / Equipment / Materials</h2>
      <div class="toolbar" style="margin-bottom:10px">
        <button class="btn sm brand" type="button" data-add="items">+ Add Item</button>
        <button class="btn sm ghost" type="button" data-clear="items">Clear Table</button>
      </div>
      <div class="help">Track equipment on site or materials used.</div>
      <table data-table="items">
        <thead>
        <tr>
          <th>Item</th>
          <th>Qty</th>
          <th>Unit</th>
          <th>Location</th>
          <th>Notes</th>
          <th class="cell-actions">Actions</th>
        </tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>

  </div>

  <!-- Notes -->
  <section class="card" style="margin-top:16px">
    <h2>General Notes / Safety / Inspections</h2>
    <textarea id="notes" placeholder="Inspections completed, safety talks, issues, weather delays, etc."></textarea>
  </section>

  <!-- Actions -->
  <div class="sticky-actions">
    <div class="toolbar">
      <button class="btn accent" id="exportJson" type="button">Export JSON</button>
      <input class="hidden" id="importFile" type="file" accept="application/json" />
      <button class="btn" id="importJson" type="button">Import JSON</button>
      <button class="btn" id="clearAll" type="button">Clear All</button>
      <button class="btn brand" id="printPage" type="button">Print</button>
      <span class="help">Autosaves locally. Export to back up or move between devices.</span>
    </div>
  </div>

</main>

<script>
/* =========================
   CONFIG: table schemas
   ========================= */
const TABLES = {
  manpower: [
    {key:'company', type:'text', placeholder:'Company'},
    {key:'crew', type:'text', placeholder:'Crew / Name'},
    {key:'hours', type:'number', placeholder:'Hours', attrs:{min:'0', step:'0.25'}},
    {key:'task', type:'text', placeholder:'Task'},
  ],
  vendors: [
    {key:'vendor', type:'text', placeholder:'Vendor'},
    {key:'contact', type:'text', placeholder:'Contact'},
    {key:'phone', type:'text', placeholder:'Phone'},
    {key:'work', type:'text', placeholder:'Work / Notes'},
  ],
  deliveries: [
    {key:'vendor', type:'text', placeholder:'Vendor'},
    {key:'item', type:'text', placeholder:'Item'},
    {key:'qty', type:'number', placeholder:'Qty', attrs:{min:'0', step:'1'}},
    {key:'unit', type:'text', placeholder:'Unit'},
    {key:'time', type:'time', placeholder:'Time'},
    {key:'received', type:'checkbox'},
    {key:'notes', type:'text', placeholder:'Notes'},
  ],
  items: [
    {key:'item', type:'text', placeholder:'Item / Equipment'},
    {key:'qty', type:'number', placeholder:'Qty', attrs:{min:'0', step:'1'}},
    {key:'unit', type:'text', placeholder:'Unit'},
    {key:'location', type:'text', placeholder:'Location'},
    {key:'notes', type:'text', placeholder:'Notes'},
  ],
};

const STORAGE_KEY = 'daily_report_v1';

/* =========================
   UTILITIES
   ========================= */
function el(tag, attrs={}, children=[]){
  const e = document.createElement(tag);
  for(const [k,v] of Object.entries(attrs||{})){
    if(k === 'class') e.className = v;
    else if(k === 'dataset'){
      Object.entries(v).forEach(([dk,dv]) => e.dataset[dk] = dv);
    } else if(k in e){
      e[k] = v;
    } else {
      e.setAttribute(k, v);
    }
  }
  (Array.isArray(children) ? children : [children]).filter(Boolean).forEach(c=>{
    if(typeof c === 'string') e.appendChild(document.createTextNode(c));
    else e.appendChild(c);
  });
  return e;
}

/* Create an input based on a column definition */
function buildInput(def, value){
  if(def.type === 'checkbox'){
    const i = el('input', {type:'checkbox'});
    i.checked = !!value;
    return i;
  }
  const attrs = Object.assign({type:def.type||'text', placeholder:def.placeholder||''}, def.attrs||{});
  const i = el('input', attrs);
  if(value != null) i.value = value;
  return i;
}

/* =========================
   TABLE ROW MANAGEMENT
   ========================= */
function addRow(tableKey, presetData=null){
  const schema = TABLES[tableKey];
  const table = document.querySelector(`table[data-table="${tableKey}"] tbody`);
  if(!table || !schema){ console.warn('Missing table or schema for', tableKey); return; }

  const tds = schema.map(col=>{
    const input = buildInput(col, presetData ? presetData[col.key] : null);
    // Tag to know how to serialize
    input.dataset.key = col.key;
    return el('td', {}, input);
  });

  const actions = el('td', {class:'cell-actions'},
    el('button', {class:'del', type:'button', 'aria-label':'Delete row'}, 'Delete')
  );

  const tr = el('tr', {}, [...tds, actions]);
  table.appendChild(tr);
}

function clearTable(tableKey){
  const tbody = document.querySelector(`table[data-table="${tableKey}"] tbody`);
  if(tbody) tbody.innerHTML = '';
  saveAll(); // keep storage consistent
}

/* =========================
   AUTOSAVE & RESTORE
   ========================= */
function collectData(){
  const data = {
    header:{
      projectName: document.getElementById('projectName').value || '',
      reportDate: document.getElementById('reportDate').value || '',
      superintendent: document.getElementById('superintendent').value || '',
      weather: document.getElementById('weather').value || '',
      notes: document.getElementById('notes').value || '',
    },
    tables:{}
  };

  for(const key of Object.keys(TABLES)){
    const rows = [];
    document.querySelectorAll(`table[data-table="${key}"] tbody tr`).forEach(tr=>{
      const row = {};
      TABLES[key].forEach((col, idx)=>{
        const input = tr.children[idx].querySelector('input,textarea,select');
        if(!input) return;
        row[col.key] = (col.type === 'checkbox') ? !!input.checked : (input.value ?? '');
      });
      rows.push(row);
    });
    data.tables[key] = rows;
  }
  return data;
}

function saveAll(){
  try{
    const data = collectData();
    localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
  }catch(e){ console.error('Save failed', e); }
}

function restoreAll(){
  const raw = localStorage.getItem(STORAGE_KEY);
  if(!raw) return;

  try{
    const data = JSON.parse(raw);
    const h = data.header || {};
    document.getElementById('projectName').value = h.projectName || '';
    document.getElementById('reportDate').value = h.reportDate || '';
    document.getElementById('superintendent').value = h.superintendent || '';
    document.getElementById('weather').value = h.weather || '';
    document.getElementById('notes').value = h.notes || '';

    // tables
    for(const key of Object.keys(TABLES)){
      clearTable(key);
      const rows = (data.tables && data.tables[key]) || [];
      rows.forEach(r => addRow(key, r));
    }
  }catch(e){ console.error('Restore failed', e); }
}

/* =========================
   EXPORT / IMPORT / PRINT
   ========================= */
function exportJSON(){
  const data = collectData();
  const blob = new Blob([JSON.stringify(data, null, 2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  const date = (data.header.reportDate || new Date().toISOString().slice(0,10));
  a.href = url;
  a.download = `daily-report-${date}.json`;
  document.body.appendChild(a);
  a.click();
  a.remove();
  URL.revokeObjectURL(url);
}

function importJSON(file){
  if(!file) return;
  const reader = new FileReader();
  reader.onload = () => {
    try{
      const data = JSON.parse(reader.result);
      // Write to storage then restore for consistent flow
      localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
      restoreAll();
    }catch(e){
      alert('Invalid JSON file.');
    }
  };
  reader.readAsText(file);
}

/* =========================
   EVENT WIRING
   ========================= */
document.addEventListener('DOMContentLoaded', () => {
  // Default date to today if empty
  const dateEl = document.getElementById('reportDate');
  if(dateEl && !dateEl.value){
    const today = new Date().toISOString().slice(0,10);
    dateEl.value = today;
  }

  // Restore saved state
  restoreAll();

  // Add-row buttons
  document.querySelectorAll('[data-add]').forEach(btn=>{
    btn.addEventListener('click', () => {
      const key = btn.dataset.add;
      addRow(key);
      saveAll();
    });
  });

  // Clear-table buttons
  document.querySelectorAll('[data-clear]').forEach(btn=>{
    btn.addEventListener('click', () => {
      const key = btn.dataset.clear;
      if(confirm('Clear all rows in this table?')) clearTable(key);
    });
  });

  // Delete row (event delegation)
  document.body.addEventListener('click', (e)=>{
    const delBtn = e.target.closest('.del');
    if(delBtn){
      const tr = delBtn.closest('tr');
      tr?.remove();
      saveAll();
    }
  });

  // Autosave on any input change
  document.body.addEventListener('input', (e)=>{
    const t = e.target;
    if(t.matches('input, textarea, select')) saveAll();
  });

  // Export / Import / Print / Clear All
  document.getElementById('exportJson').addEventListener('click', exportJSON);

  const importBtn = document.getElementById('importJson');
  const importFile = document.getElementById('importFile');
  importBtn.addEventListener('click', ()=> importFile.click());
  importFile.addEventListener('change', (e)=> importJSON(e.target.files[0]));

  document.getElementById('printPage').addEventListener('click', ()=> window.print());

  document.getElementById('clearAll').addEventListener('click', ()=>{
    if(confirm('Clear everything on this page? This will remove local data.')){
      localStorage.removeItem(STORAGE_KEY);
      // Clear inputs
      ['projectName','reportDate','superintendent','weather','notes'].forEach(id=>{
        const el = document.getElementById(id);
        if(el) el.value = (id==='reportDate') ? '' : '';
      });
      // Clear tables
      Object.keys(TABLES).forEach(clearTable);
    }
  });

  // If any table is empty at first load, put one starter row to hint usage
  Object.keys(TABLES).forEach(key=>{
    const tbody = document.querySelector(`table[data-table="${key}"] tbody`);
    if(tbody && !tbody.children.length) addRow(key);
  });
});
</script>
</body>
</html>











